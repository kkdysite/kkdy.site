<!DOCTYPE html>
<html>

<head>

    <head>
        <meta charset="utf-8">
        <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>app下载和注册</title>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <link rel="stylesheet" href="http://cdn.jsdelivr.net/gh/kkdysite/webapp/sui-mobile/dist/css/sm.min.css">
        <script src='http://cdn.jsdelivr.net/gh/kkdysite/webapp/jquery/3.1.1/jquery.min.js'></script>
        <script src='http://cdn.jsdelivr.net/gh/kkdysite/webapp/jquery-cookie/1.4.1/jquery.cookie.min.js'></script>
        <script src="http://cdn.jsdelivr.net/gh/kkdysite/webapp/clipboard.js/2.0.6/clipboard.min.js"></script>
        <script src="http://cdn.jsdelivr.net/gh/kkdysite/webapp/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
    </head>
    <script src="https://cdn.jsdelivr.net/gh/kkdysite/webapp/sui-mobile/dist/js/sm.js"></script>


<body>
    <div class="page-group">
        <div class="page page-current" id="page_index">
            <header class="bar bar-nav">
                <h1 class="title">App下载</h1>
            </header>
            <div class="content">
                <div class="content-block-title" style="text-align: center;">极简、稳定、清晰、高速</div>

                <div class="card cardmain">
                    <div class="buttons-tab">
                        <a href="#page_index" class=" active button">下载</a>
                        <a href="#page_reg" class=" button">注册</a>
                    </div>
                    <div class="content-block">
                        <div class="content-block-title">你当前的系统是 <span class="p_name"></span></div>
                        <div class="card">
                            <div class="card-content">
                                <div class="card-content-inner">
                                    <div class="bef_tuijianlink"></div>
                                    <a href="#" class="dl button button-big button-fill button-success tuijianlink"
                                        ></a>
                                    <a href="#page_reg" class="dl button button-big  button-success">注册账号</a>
                                </div>
                            </div>
                            <div class="card-footer">你有账号了吗？ <a href="#page_reg">没有，我要注册</a></div>
                        </div>

                        <div class="content-block-title">其他客户端下载</div>
                        <div class="card">
                            <div class="card-content">
                                <div class="card-content-inner">

                                    <div class="alldownloadlink">

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page_dl_tpl">
            <header class="bar bar-nav">
                <h1 class="title">App下载</h1>
            </header>
            <div class="content">
                <div class="content-block-title" style="text-align: center;">极简、稳定、清晰、高速</div>
                <div class="card cardmain">
                    <div class="buttons-tab">
                        <a href="#page_index" class=" active button">下载</a>
                        <a href="#page_reg" class=" button">注册</a>
                    </div>
                    <div class="content-block">
                        <div class="content-block-title">你当前的系统是 <span class="p_name"></span> <a href="#page_index" class="gotoindex">点这里安装<span class="p_name"></span>版</a></div>
                        <div class="card">
                            <div class="card-content">
                                <div class="card-content-inner htmls">


                                </div>
                            </div>
                            <div class="card-footer">你有账号了吗？ <a href="#page_reg">没有，我要注册</a></div>
                        </div>
                        <div class="content-block-title">其 他客户端下载</div>
                        <div class="card">
                            <div class="card-content">
                                <div class="card-content-inner">
                                    <div class="alldownloadlink">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

        <div class="page" id="page_safari">
            <header class="bar bar-nav">
                <h1 class="title">如何使用Safari打开</h1>
            </header>
            <div class="content">
                <div class="content-block-title" style="text-align: center;">极简、稳定、清晰、高速</div>
                <div class="card cardmain">
                    <div class="buttons-tab">
                        <a href="#page_index" class=" active button">下载</a>
                        <a href="#page_reg" class=" button">注册</a>
                    </div>
                    <div class="content-block">
                        <div class="content-block-title">查看如何在Safari中打开本页面
                        </div>
                        <div class="card">
                            <div class="card-content">
                                <div class="card-content-inner htmls">
                                    
                                </div>
                            </div>
                            <div class="card-footer">你有账号了吗？ <a href="#page_reg">没有，我要注册</a></div>
                        </div>
                        <div class="content-block-title">其 他客户端下载</div>
                        <div class="card">
                            <div class="card-content">
                                <div class="card-content-inner">
                                    <div class="alldownloadlink">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page_reg">
            <header class="bar bar-nav">
                <h1 class="title">注册账号</h1>
            </header>

            <div class="content">
                <div class="content-block-title" style="text-align: center;">快速注册账号</div>
                <div class="card cardmain">
                    <div class="buttons-tab">
                        <a href="#page_index" class=" button">下载</a>
                        <a href="#page_reg" class=" active button">注册</a>
                    </div>
                    <div class="content-block">
                        <div class="content-block-title">请完整填写后注册</div>

                        <div class="card">
                            <div class="card-content">

                                <form id="u_reg" action="#" method="POST">

                                    <div class="list-block">
                                        <ul>
                                            <li>
                                                <div class="item-content">
                                                    <div class="item-inner">
                                                        <div class="item-title label">邀请码</div>
                                                        <div class="item-input">
                                                            <input type="text" name="uid" placeholder="必须填写"
                                                                autocomplete="on" value="9990">
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="item-content">
                                                    <div class="item-inner">
                                                        <div class="item-title label">邮箱</div>
                                                        <div class="item-input">
                                                            <input type="text" name="user_email"
                                                                placeholder="用于接收新版通知" "="" autocomplete=" on">
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="item-content">
                                                    <div class="item-inner">
                                                        <div class="item-title label">用户名</div>
                                                        <div class="item-input">
                                                            <input type="text" name="user_name"
                                                                placeholder="英文和数字" "="" autocomplete=" off">
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>

                                            <li>
                                                <div class="item-content">
                                                    <div class="item-inner">
                                                        <div class="item-title label">密码</div>
                                                        <div class="item-input">
                                                            <input type="password" name="user_pwd" placeholder="请输入密码"
                                                                autocomplete="off">
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="item-content">
                                                    <div class="item-inner">
                                                        <div class="item-title label">密码确认</div>
                                                        <div class="item-input">
                                                            <input type="password" name="user_pwd2" placeholder="请再次输入"
                                                                autocomplete="off">
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="content-block">
                                        <div class="col-50"><a href="#"
                                                class="button button-big button-fill button-success"
                                                onclick="javascript:u_reg();">注册账号</a></div>
                                    </div>
                                    <div class="content-block-title">关于邀请码</div>

                                    <div class="card">
                                        <div class="card-content">
                                            <div class="card-content-inner">系统小范围使用，只有有邀请码的朋友才可以注册使用。注册后默认送一周会员。</div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="card-footer">你下载客户端了吗？ <a href="#page_index">没有，我要下载</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="all_dl_links_tpl">
        <a href="#page_dl_android">安卓版</a>
        <a href="#page_dl_ios">苹果版</a>
        <a href="#page_dl_windows">Win电脑版</a>
        <a href="#page_dl_mac">mac电脑版</a>
        <a href="#page_dl_tv">机顶盒版</a>
        <a href="#page_dl_linux">Linux版</a>
        <a href="#page_dl_unix">Unix版</a>
        <a href="#page_dl_Portable">免安装版</a>

        <div class="card">
            <div class="card-content">
              <div class="card-content-inner" style="text-align: center;">
                <p>扫描二维码下载</p>

                <div class="shap_qrcode">

                </div>

              </div>
            </div>
          </div>

    </div>
    <div id="shap_qrcode"></div>
</body>
<style>
    .page .cardmain {
        margin: 0 auto;
        padding-bottom: 1rem;
        max-width: 20rem;
    }
    .dl {margin: 0.5rem;}
    #all_dl_links_tpl {
        display: none;
    }
    .copy_url_txt{display:block;padding:.2rem 1rem;border:1px solid red;background:#fff;color:red;}

    .shap_qrcode table, .shap_qrcode canvas{width: 100%; margin: 0 auto;}
</style>
<script>
var user_agent = navigator.userAgent.toLowerCase();

var arr_url=window.location.href.split("#");
jQuery('#shap_qrcode').qrcode({
    render: "table", //也可以替换为 table
    foreground: "#000",
    text: arr_url[0]
    //text: 'http://baidu.com'
});

$('.shap_qrcode').html($('#shap_qrcode').html());

var Portable_html = "因为我们没有办法适配所有设备，所以我们提供了免安装版本，在无法正常安装客户端的设备上你可以尝试直接使用浏览器打开使用<br><span class='copy_url_txt' id='Tvurl'>http://t.kkdy.website/</span><a href='#' data-clipboard-action='copy' class='copyTvurl' data-clipboard-target='#Tvurl'>复制地址</a>&nbsp;支持大部分智能设备。<br>&nbsp;&nbsp;注意1：免安装版本只有基本的观影功能。需要配合手机客户端使用<br>&nbsp;&nbsp;注意2：机顶盒使用地址要填写完整包括http以及后面的冒号斜杠。<br>旧版机顶盒如果无法直接使用，请使用第三方电视浏览器。比如：电视家浏览、艾克思浏览器，支持鼠标的机顶盒请也可以尝试使用安卓版或者chrome等专业浏览器";
var p_set = {
        'android': {
            'name': '安卓手机','button_name': "下载安卓版",'dl_link_name': '下载 看看电影.apk',
            'dl_link_url': 'https://cdn.jsdelivr.net/gh/kkdysite/webapp/ClientApp/kkdy.Phone.2.2.apk',
            'html': "下载后是apk文件，请在设置中允许安装未知来源的应用程序，否则不能安装。   <br>   部分设备提示版本更新，忽略即可。不影响正常使用。   <br>   通常在 系统设置 找到 未知来源 并勾选，不同品牌手机设置项目位置差异大，在设置中搜索或查看 系统安全 或 应用程序配置 或 未知来源应用权限管理列表 等位置。因为没有在对应品牌的安卓手机市场上架，所以需要允许安装未知来源软件。   "
        },
        'windows': {
            'name': 'Win电脑','button_name': "下载Win电脑版",'dl_link_name': '下载 看看电影 安装包',
            'dl_link_url': 'https://kkdy.lanzous.com/b00trimah',
            'html': "部分电脑可能会提示检查风险，请点其他 允许运行即可。 <br> 注意：基于win10开发，兼容win7（需要用兼容性模式运行) "
        },
        'mac': {
            'name': 'mac电脑','button_name': "下载mac版本",'dl_link_name': '下载 看看电影.app',
            'dl_link_url': 'https://kkdy.lanzous.com/b00trik8d',
            'html': "mac版下载后解压，打开访达，拖动到应用程序里面。首次运行可能会提示安全风险，在系统偏好设置 安全与隐私 打开。以后打开不会再继续提示。<br>仅支持macos10.12 以后的系统。更低版本请使用免安装版"
        },
        'ios': {
            'name': 'IOS设备','button_name': "安装ios版本",'dl_link_name': '','dl_link_url': '',
            'html': '因为苹果系统诸多限制，此类app不可以通过常规方式安装。<br><span class="nosafari"></span><span class="issafari">请您认真阅读下面的信息，按照提示进行安装。<br>本app在ios系统上用的是桌面书签的安装方式，首先需要确保是使用的手机自带的safari浏览器打开的本页，然后需要:<br>逐个点击下面的两个按钮，然后在弹出的页面中按照提示创建两个桌面图标。其中一个作为常用，另外一个在常用打不开的时候选择使用。</span>'
        },
        'unix': {
            'name': 'unix设备','button_name': "使用免安装版",'dl_link_name': '','dl_link_url': '',
            'html': Portable_html
        },
        'linux': {
            'name': 'linux电脑','button_name': "使用免安装版",'dl_link_name': '','dl_link_url': '',
            'html': Portable_html
        },

        'other': {
            'name': '未识别成功',
            'button_name': "使用免安装版",
            'dl_link_name': '',
            'dl_link_url': '',
            'html': Portable_html
        },

        'tv': {
            'name': 'tv版本',
            'button_name': "使用免安装版",
           
            'dl_link_name': '',
            'dl_link_url': '',
            'html': "机顶盒首选使用安卓版本，如果不可以使用请选择免安装版本<br>" + Portable_html
        },

        'Portable': {
            'name': '免安装版本',
            'button_name': "使用免安装版",
           
            'dl_link_name': '',
            'dl_link_url': '',
            'html': "" + Portable_html
        },
    };
    $('.alldownloadlink').html($("#all_dl_links_tpl").html()); //复制下载地址链接
   

    var temp_html;
    $.each(p_set, function (name, value) {
        $('.page-group').append(' <div class="page" id="page_dl_' + name + '"> 123</div>'); //创建路由页
        $('#page_dl_' + name).html($("#page_dl_tpl").html()); //从模板复制内容
        temp_html = '';
        if (value['dl_link_name'] != "") {
            temp_html += '<a href="' + value['dl_link_url'] + '" class="dl button button-big button-fill button-success" target="_bank" title="mac" external>' + value['dl_link_name'] + '</a>';
        }

        if (value['html'] != "") {
            temp_html += value['html'];
        }

        $('#page_dl_' + name + ' .htmls').html(temp_html);
    });

    var p_name =getos();

    $('.p_name').html(p_set[p_name]['name']);//提示设备
    $('.tuijianlink').html(p_set[p_name]['button_name']); //推荐下载名称
    $('.tuijianlink').attr('href', '#page_dl_'+p_name); //推荐按钮的链接
    $('.gotoindex').attr('href', '#page_dl_'+p_name); //推荐按钮的链接
    $('#page_dl_'+p_name+" .gotoindex").hide();//隐藏无用的推荐链接 gotoindex
    $('.bef_tuijianlink').html("推荐你选择<br>");
        //检测 ios的safari
    if(p_name=='ios'){
        console.log("确定是ios");
        if( /safari/.test(user_agent) && !/chrome/.test(user_agent)  ){
            console.log("判断是Safari 且不是 chrome内核的qq 360等");
            if (arr_url[1]=='page_safari'){
                //跳转回首页
                window.location.href=arr_url[0]+"#page_index";
            }
        }else{
            $('.tuijianlink').html("查看如何用Safari打开"); //推荐下载名称
            $('.tuijianlink').attr('href', '#page_safari'); //推荐按钮的链接
            $('.bef_tuijianlink').html('你可以继续注册账号或者查看其他信息。但是iPhone和ipad因为系统限制，不允许此类app在第三方浏览器上完成客户端安装，如果要安装客户端，请使用手机自带的Safari浏览器打开本页面。');
        }
        var open_safari_html='';
        //判断是否在微信或者qq里面
        
        if( (/micromessenger/.test(user_agent) ) ||  (/qq/.test(user_agent) ) ) { //微信
            open_safari_html='如果是在微信或QQ中打开的，点击屏幕右上角的三个点，在弹出的菜单中选择 类似指南针的图标，在 Safari 中 打开 即可。<img src="https://cdn.jsdelivr.net/gh/kkdysite/webapp/img/open_from_wechat_qq.jpg" /><br>或者';
        }
        
        open_safari_html+='复制本页面地址，返回手机桌面，找到 Safari 打开，地址栏输入地址。<div class="copy_url_txt" id="myurl">'+arr_url[0]+'</div> <a href="#" data-clipboard-action="copy" class="copymyurl" data-clipboard-target="#myurl">复制地址</a><br><img src="https://cdn.jsdelivr.net/gh/kkdysite/webapp/img/open_safari_fromdesktop.jpg" />';
        $('#page_safari .htmls').html(open_safari_html);

    }

    

    function getos() {
        
        if (/(iphone|ipad|ipod|ios)/i.test(user_agent)) {
            return 'ios';
        } else if (/(android)/i.test(user_agent)) {
            return 'android';
        }
        else if (/(windows)/i.test(user_agent)) {
            return 'windows';
        }
        else if (/(macintosh)/i.test(user_agent)) {
            return 'mac';
        }
        else if (/(unix)/i.test(user_agent)) {
            return 'unix';
        }
        else if (/(linux)/i.test(user_agent)) {
            return 'linux';
        }
        else {
            return 'other';
        };
    }


//复制到剪切板
var clipboard = new ClipboardJS('.copymyurl');
clipboard.on('success', function (e) {
    $.toast("复制成功，你可以粘贴到Safari了");
    e.clearSelection();
});
clipboard.on('error', function (e) {
    $.toast("复制失败，请手动复制");

});


var clipboard = new ClipboardJS('.copyTvurl');
clipboard.on('success', function (e) {
    $.toast("复制成功，你可以粘贴到别处了");
    e.clearSelection();
});
clipboard.on('error', function (e) {
    $.toast("复制失败，请手动复制");

});
</script>

</html>
